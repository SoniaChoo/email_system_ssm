<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
<title>HTML注册登录页面模板</title>
<link rel="stylesheet" href="css/style.css">

    <script src="./statics/jquery-3.5.1.js"></script>
    <script src="js/script.js"></script>

</head>

<body>
    <div class="content"style="text-align:center; line-height: normal" >
        <div id="mycontent" style="border: #8fa1c7; height: 200px; width: 200px"></div>
        <div class="f">
            <div id="myaccount">账号:</div>
            <div id="mypassword">密码:</div>
            <div>
                <p class="forgot-pass"><span style="color: #27282a"><strong>注意！</strong></span><a href="javascript:">必须先在百度云点击获取验证码</a></p>

                <p class="forgot-pass"><a href="javascript:">再点击下方按钮</a></p>
            </div>

            <button type="button" id="btn" class="submit" onclick="getCaptchaCode()">获取验证码</button>
        </div>

    </div>


	
<!--	<div style="text-align:center;">-->
<!--<p>还没获得邮箱账号信息?：<a href="login_bak.html" target="_blank">邀请码验证</a></p>-->
<!--</div>-->

    <script>
        $('#btn').click(function(){
            $('#btn').text('倒计时30s');
            $('#btn').prop('disabled',true);
            // 设置 cookie 值
            $(document)[0].cookie = 'ckey='+30;
            console.log('cookie 设置完毕');

        });
        function setStyle(){
            var cval = getCookie();
            if(cval>1){
                $('#btn').text('倒计时'+cval+'s');
                $('#btn').prop('disabled',true);
                console.log('hahah')
            }else{
                $('#btn').text('获取验证码');
                $('#btn').prop('disabled',false);
            }
        }
        setStyle();

        id = setInterval(function(){
            setCookie();
            console.log(1);
        },1000)

        function setCookie(){
            var cval = getCookie();
            if(cval>1){
                $(document)[0].cookie = 'ckey='+(cval-1);
                $('#btn').text('倒计时'+(cval-1)+'s');
                $('#btn').prop('disabled',true);
            }else if(cval==1){
                $('#btn').text('获取验证码');
                $('#btn').prop('disabled',false);
                $(document)[0].cookie = 'ckey='+0;
                // clearInterval(id);
            }
        }
        function getCookie(){
            // 获取全部的 cookie
            var cookie = $(document)[0].cookie;
            // 获取 cookie 项  (数组)
            var citem = cookie.split(';');
            // 过滤数组  获得 键为 ckey 的项
            var ckey = citem.filter(function(item){
                return item.split('=')[0].trim()=='ckey';
            });
            // 获得 时间  cval
            cval = ckey[0].split('=')[1];
            return cval;
        }
    </script>

    <script>
        function parseUrl(url){
            if(url.indexOf("?") == -1) {
                return {};
            }
            var query = url.split("?")[1];
            var queryArr = query.split("&");
            var obj = {};
            queryArr.forEach(function(item){
                var key = item.split("=")[0];
                var value = item.split("=")[1];
                obj[key] = decodeURIComponent(value);
            });
            return obj;
        }


        var urlMsg = parseUrl(window.location.search);
        document.getElementById("myaccount").innerHTML = "账号:"+urlMsg.captchaTo;
        document.getElementById("mypassword").innerHTML = "密码:"+urlMsg.mypwd;
        function getCaptchaCode() {
            $.ajax({
                url:"./invitation/searchCaptcha?invitationCode="+urlMsg.invitationCode+"&captchaTo="+urlMsg.captchaTo,
                success:function (captchaData) {
                    if (captchaData.code===1){
                        alert("邀请码不正确")
                    }else if (captchaData.code===2){
                        alert("邀请码已过期")
                    }else if(captchaData.code===3) {
                        alert("邮箱不正确")
                    }else if (captchaData.code===4) {
                        alert("一个邀请码一天只能获取验证码不超过5次")
                    }else if (captchaData.code === 5){
                        alert("还没有收到验证码")
                    }else {
                        alert(captchaData.data.captchaCode);
                    }
                }
            })
        }
    </script>
</body>

</html>